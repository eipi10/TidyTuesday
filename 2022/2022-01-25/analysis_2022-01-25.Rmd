---
title: "TidyTuesday week 3"
author: "Iker Rivas-Gonz√°lez"
date: "11/1/2022"
output: html_document
editor_options: 
  chunk_output_type: inline
---

Load the data:

```{r}

library(tidyverse)
library(tidytuesdayR)
library(showtext)
library(ggthemes)
font_add_google("Open Sans", "opensans")
showtext_auto()


# Get the Data

# Read in with tidytuesdayR package 
# Install from CRAN via: install.packages("tidytuesdayR")
# This loads the readme and all the datasets for the week of interest

# Either ISO-8601 date or year/week works!

tuesdata <- tidytuesdayR::tt_load('2022-01-25')

ratings <- tuesdata$ratings
details <- tuesdata$details

boardgames <- 
  full_join(ratings, details, by = 'id')

```

```{r}

library(GGally)

boardgames %>% 
  dplyr::transmute(
    average, 
    yearpublished = log(yearpublished), 
    minplayers, maxplayers, playingtime, minage
    ) %>% 
ggpairs()

```
```{r}

category <- boardgames %>% 
  dplyr::select(name, boardgamecategory, bayes_average, thumbnail) %>% 
  group_by(name, bayes_average, thumbnail) %>% 
  mutate(
    cat = str_remove_all(boardgamecategory, "\\'"),
    cat = str_remove_all(cat, "\\["),
    cat = str_remove_all(cat, "\\]"),
    cat = str_remove_all(cat, "\""),
    cat = str_replace_all(cat, "Childrens", "Children\\'s")
  ) %>% 
  summarise(
    cat = str_split(cat, ', ')
  ) %>% 
  unnest(cat)

```



```{r}

category %>% 
  group_by(cat) %>%
  mutate(
    group_average = mean(bayes_average), 
    n = n()
  ) %>% 
  top_n(1, bayes_average) %>% 
  arrange(desc(n))

```


```{r}

library(gt)



img_name <- c(
  "https://czechgames.com/for-press/through-the-ages/through-the-ages-05.png",
  "https://images-cdn.fantasyflightgames.com/filer_public/8d/f8/8df8d3c5-ff36-4efe-83b6-d1383329902d/ti07_logo.jpg",
  "https://steamcdn-a.akamaihd.net/steam/apps/780290/extras/gh-logo.png?t=1553181050",
  "https://www.decrypto.info/img/logo.png",
  "https://stoffelpresents.com/wp-content/uploads/2019/03/logo_english.png",
  "https://www.dafont.com/forum/attach/orig/6/4/648626.jpg",
  "https://steamcdn-a.akamaihd.net/steam/apps/780290/extras/gh-logo.png?t=1553181050",
  "https://eljuegonauta.com/wp-content/uploads/2016/12/IMG_20161214_000027_HDR-e1485089428758.jpg",
  "https://www.board-game.co.uk/wp-content/uploads/2018/04/Azul-Board-Game-Review.jpg",
  "https://www.board-game.co.uk/wp-content/uploads/2018/10/Brass-Birmingham-Review.jpg",
  
  "https://www.ultraboardgames.com/great-western-trail/gfx/logo.jpg",
  "https://boardgaming.com/wp-content/uploads/2012/04/Memoir-44-logo.jpg",
  "https://www.deepcomics.com/wp-content/uploads/2015/10/Android-netrunner-logo.png",
  "https://www.clipartmax.com/png/middle/456-4560391_from-wikipedia-the-free-encyclopedia-secret-hitler-logo-transparent.png",
  "https://steamcdn-a.akamaihd.net/steam/apps/780290/extras/gh-logo.png?t=1553181050",
  "https://images.beastsofwar.com/2019/09/76742382-BSG001A-BattlestarGalactica_StarshipBattles-Logo-Large-999.png",
  "https://steamcdn-a.akamaihd.net/steam/apps/780290/extras/gh-logo.png?t=1553181050"
)



plots_dat <- category %>% 
  group_by(cat) %>%
  summarize(
    group_average = mean(bayes_average), 
    n = n()
  ) %>% 
  top_n(17) %>% 
  left_join(category, by = "cat") %>% 
  group_by(cat) %>% 
  dplyr::select(bayes_average) %>% 
  nest() %>% 
  rowwise() %>% 
  mutate(
    plots = list(
      ggplot(data, aes(bayes_average)) +
        geom_density(size = 5) +
        scale_x_continuous(limits = c(5, 10)) +
        theme_minimal() +
        theme(
          text=element_text(size=100),
          axis.title = element_blank(),
          axis.text.y = element_blank()
          ))
  ) %>%
  ungroup() %>% 
  filter(
    cat != 'Miniatures', 
    cat != 'Fighting',
    cat != 'Adventure'
  ) 

gt_tab <- category %>% 
  group_by(cat) %>%
  mutate(
    group_average = median(bayes_average), 
    n = n()
  ) %>% 
  top_n(1, bayes_average) %>% 
  arrange(desc(n)) %>% 
  ungroup() %>% 
  top_n(17, n) %>% 
  mutate(ggplot = NA, img = img_name, group_average = round(group_average, 3)) %>% 
  arrange(desc(group_average)) %>% 
  filter(
    cat != 'Miniatures', 
    cat != 'Fighting',
    cat != 'Adventure'
  ) %>% 
  dplyr::select(cat, n, ggplot, group_average, name, bayes_average, img) %>% 
  gt() %>%
  tab_header(
    title = md("Best game by category"),
    subtitle = "This is the subtitle"
  ) %>%
  tab_source_note(
    md("More information is available at `?exibble`.")
    )  %>% 
  text_transform(
    locations = cells_body(ggplot),
    fn = function(x) {map(plots_dat$plots, ggplot_image, height = px(40), aspect_ratio = 3)}
    ) %>% 
  text_transform(
    locations = cells_body(img),
    fn = function(x) {
      web_image(
        url = x
      )
    }
    ) %>% 
      cols_align(
      align = c("center"),
    ) %>% 
  data_color(
    columns = bayes_average,
    colors = scales::col_numeric(
      palette = 'Oranges',
      domain = c(6.998, 8.552))
  ) %>% 
  data_color(
    columns = group_average,
    colors = scales::col_numeric(
      palette = 'Blues',
      domain = c(5.506, 5.603))
  )

gtsave(gt_tab, 'gttab.html')



```



